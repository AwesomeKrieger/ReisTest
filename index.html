<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rice Purity | Liquid Glass</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --bg: #ffffff;
            --glass: rgba(255, 255, 255, 0.75);
            --glass-border: rgba(0, 0, 0, 0.08);
            --text: #000000;
            --accent: #007aff;
            --sub-text: rgba(0, 0, 0, 0.5);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg: #000000;
                --glass: rgba(25, 25, 25, 0.75);
                --glass-border: rgba(255, 255, 255, 0.1);
                --text: #ffffff;
                --accent: #0a84ff;
                --sub-text: rgba(255, 255, 255, 0.5);
            }
        }

        body {
            margin: 0;
            background: var(--bg);
            color: var(--text);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            display: flex;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 720px;
            padding: 60px 20px;
        }

        h1 { font-size: 2.8rem; font-weight: 800; text-align: center; margin-bottom: 50px; letter-spacing: -1px; }

        .glass-shell {
            background: var(--glass);
            backdrop-filter: blur(35px) saturate(160%);
            -webkit-backdrop-filter: blur(35px) saturate(160%);
            border: 1px solid var(--glass-border);
            border-radius: 32px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 30px;
        }

        .q-row {
            padding: 22px 28px;
            display: flex;
            align-items: flex-start;
            border-bottom: 1px solid var(--glass-border);
            cursor: pointer;
            transition: 0.2s ease;
        }

        .q-row:hover { background: rgba(128, 128, 128, 0.05); }

        .indicator {
            width: 26px; height: 26px;
            border: 2px solid var(--glass-border);
            border-radius: 9px;
            margin-right: 20px;
            flex-shrink: 0;
            display: flex; align-items: center; justify-content: center;
            transition: 0.3s;
        }

        .selected .indicator {
            background: var(--accent);
            border-color: var(--accent);
            box-shadow: 0 0 15px var(--accent);
        }

        .selected .indicator::after { content: "‚úì"; color: white; font-weight: bold; }

        .glossary {
            display: block; margin-top: 6px; font-size: 0.82rem;
            color: var(--sub-text); font-style: italic;
        }

        .calc-btn {
            width: 100%; padding: 24px; border-radius: 20px; border: none;
            background: var(--accent); color: white; font-size: 1.3rem;
            font-weight: 700; cursor: pointer; transition: 0.3s;
        }

        .legal-notice {
            font-size: 0.75rem; color: var(--sub-text); text-align: center;
            margin-top: 15px; line-height: 1.4;
        }

        .legal-notice span { color: var(--accent); cursor: pointer; text-decoration: underline; }

        #ds-modal {
            display: none; position: fixed; z-index: 1000; left: 0; top: 0;
            width: 100%; height: 100%; background-color: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px); align-items: center; justify-content: center;
        }

        .modal-content {
            background: var(--bg); color: var(--text); padding: 30px;
            border-radius: 24px; max-width: 500px; width: 90%;
            max-height: 70vh; overflow-y: auto; border: 1px solid var(--glass-border);
        }

        .close-btn {
            background: var(--accent); color: white; border: none;
            padding: 10px 20px; border-radius: 12px; cursor: pointer;
            float: right; margin-top: 20px;
        }

        .purity-scale { width: 100%; margin: 20px 0; }
        .scale-bar { height: 10px; background: linear-gradient(to right, #4a148c, #e91e63, #ffb300); border-radius: 5px; position: relative; }
        .indicator-arrow { position: absolute; top: -15px; transform: translateX(-50%); transition: left 1s ease-out; font-size: 12px; }
        .scale-labels { display: flex; justify-content: space-between; font-size: 10px; margin-bottom: 5px; font-weight: bold; opacity: 0.5; }
        .score-box { background: #6a1b9a; color: white; padding: 30px; border-radius: 25px; margin: 20px 0; }
        .big-number { font-size: 5rem; font-weight: 900; }
        .result-text { font-size: 1rem; margin-top: 15px; line-height: 1.4; }

       .impurity-grid { 
    display: grid; 
    grid-template-columns: repeat(3, 1fr); 
    gap: 15px; 
    margin-top: 30px; 
}

.stat-circle { 
    text-align: center; 
}

@property --p {
    syntax: '<number>';
    inherits: true;
    initial-value: 0;
}

.circle-visual {
    width: 70px;
    height: 70px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 5px;
    font-weight: bold;
    font-size: 1.2rem;
    position: relative;
    
    /* Die magische Animation */
    --p: 0;
    transition: --p 1.2s cubic-bezier(0.4, 0, 0.2, 1);
    
    /* Zeichnet den Fortschrittsring */
    background: 
        radial-gradient(closest-side, var(--bg) 80%, transparent 0%),
        conic-gradient(var(--circle-color, var(--accent)) calc(var(--p) * 1%), var(--glass-border) 0);
}

/* Zuweisung der Farben f√ºr die Kategorien */
.c-minor { --circle-color: #4cd964; }
.c-immortal { --circle-color: #007aff; }
.c-raunchy { --circle-color: #ffcc00; }
.c-scandalous { --circle-color: #ff3b30; }
.c-unspeakable { --circle-color: #ff2d55; }


#result-view { display: none; text-align: center; padding: 80px 20px; }
.final-score { font-size: 9rem; font-weight: 900; color: var(--accent); letter-spacing: -5px); }

    </style>
</head>
<body>

<div class="container" id="quiz-view">
    <h1>Rice Purity Test</h1>
    <div class="glass-shell" id="questions-list"></div>
    <button class="calc-btn" onclick="sendData()">Berechnen</button>
    <div class="legal-notice">
        Mit Klick auf "Berechnen" akzeptierst du die <span onclick="toggleModal(true)">Datenschutzerkl√§rung</span>.
    </div>
</div>

<div id="ds-modal">
    <div class="modal-content">
        <h2>Datenschutzerkl√§rung</h2>
        <p>Wir nehmen den Schutz deiner Daten ernst. Bei diesem Test werden folgende Informationen anonymisiert in einer Supabase-Datenbank gespeichert:</p>
        <ul>
            <li>Dein erzielter Score</li>
            <li>Die Dauer der Bearbeitung</li>
            <li>Technische Daten (Betriebssystem, Bildschirmaufl√∂sung)</li>
            <li>Das Klick-Muster der Antworten (Zeitpunkt der Auswahl)</li>
        </ul>
        <p>Es werden <strong>keine</strong> Namen, IP-Adressen oder pers√∂nlichen Identifikationsmerkmale gespeichert.</p>
        <button class="close-btn" onclick="toggleModal(false)">Schlie√üen</button>
    </div>
</div>

<div id="result-view" class="container">
    <div style="font-size: 1.5rem; opacity: 0.6;">Dein Score:</div>
    <div class="final-score" id="quick-score">100</div>

    <div id="stage-1-actions">
        <button class="calc-btn" onclick="revealDetails()" style="max-width:300px; margin: 0 auto; display:block;">DETAILS AUSWERTEN</button>
    </div>

    <div id="stage-2" style="display:none; margin-top: 40px;">
        <div class="purity-scale">
            <div class="scale-labels"><span>I2</span><span>I1</span><span>P1</span><span>P2</span><span>Purity üëë</span></div>
            <div class="scale-bar"><div id="purity-indicator" class="indicator-arrow">‚ñº</div></div>
            <div style="text-align:left; font-size:10px; font-weight:bold; margin-top:5px;">üòà Impurity</div>
        </div>

        <div class="score-box">
            <div id="score-val" class="big-number">100</div>
            <p id="result-msg" class="result-text"></p>
        </div>

        <div class="impurity-grid">
            <div class="stat-circle"><div class="circle-visual c-minor" id="val-minor">0</div><div class="cat-label">Kleine S√ºnden<br><small>/19</small></div></div>
            <div class="stat-circle"><div class="circle-visual c-immortal" id="val-immortal">0</div><div class="cat-label">Unmoralisch<br><small>/28</small></div></div>
            <div class="stat-circle"><div class="circle-visual c-raunchy" id="val-raunchy">0</div><div class="cat-label">Versaut<br><small>/21</small></div></div>
            <div class="stat-circle"><div class="circle-visual c-scandalous" id="val-scandalous">0</div><div class="cat-label">Skandal√∂s<br><small>/23</small></div></div>
            <div class="stat-circle"><div class="circle-visual c-unspeakable" id="val-unspeakable">0</div><div class="cat-label">Extrem<br><small>/9</small></div></div>
        </div>

        
    </div>
    <button onclick="location.reload()" style="background:none; border:none; color:var(--text); opacity:0.4; cursor:pointer; margin-top:40px; text-decoration:underline;">Test neu starten</button>
</div>

<script>
    const SUPABASE_URL = 'https://bouakrnvctugyjqxjyin.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJvdWFrcm52Y3R1Z3lqcXhqeWluIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE2MTY0MjcsImV4cCI6MjA4NzE5MjQyN30.C5o8xjY_f63oID50xIB4h1hSL6AFpwraM8YrZTR1jO0';
    const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    const startTime = Date.now();
    let pattern = [];
    let finalScoreVal = 100;
    let finalStats = { minor: 0, immortal: 0, raunchy: 0, scandalous: 0, unspeakable: 0 };

    function toggleModal(show) {
        document.getElementById('ds-modal').style.display = show ? 'flex' : 'none';
    }

    function getDetailedCategory(id) {
        if ([1,2,3,4,5,6,7,8,9,10,11,12,13,14,44,45,46,53,55].includes(id)) return "minor";
        if ([15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,47,48,49,50,54,56,57,58].includes(id)) return "immortal";
        if ([35,36,37,38,39,40,41,42,43,67,68,69,70,71,72,73,74,75,80,81,92].includes(id)) return "raunchy";
        if ([51,52,59,60,61,62,63,64,65,66,76,77,78,79,82,83,84,85,86,87,88,89,90].includes(id)) return "scandalous";
        return "unspeakable";
    }

    function getResultText(s) {
        if (s >= 98) return "Ein wahrer Engel! Deine Reinheit ist fast schon unheimlich.";
        if (s >= 85) return "Sehr anst√§ndig. Ein Vorbild f√ºr die Gesellschaft.";
        if (s >= 65) return "Ein gesundes Mittelma√ü. Du wei√üt, wo die Grenzen sind.";
        if (s >= 35) return "Du lebst das Leben! Ziemlich versaut.";
        if (s >= 10) return "Ganz sch√∂n wild! Es gibt kaum etwas, das du nicht probiert hast.";
        return "Legende! Du hast das Leben im Hardcore-Modus durchgespielt.";
    }

    const rawQuestions = [
        ["Romantisch H√§ndchen gehalten?", ""],
        ["Ein Date gehabt?", ""],
        ["In einer Beziehung gewesen?", ""],
        ["Eng getanzt?", "Ohne Abstand zwischen den K√∂rpern"],
        ["Jemanden gek√ºsst?", "Keine Familienmitglieder"],
        ["Auf den Mund gek√ºsst?", ""],
        ["Einen Zungenkuss gehabt?", "French Kiss"],
        ["Zungenkuss in der √ñffentlichkeit gehabt?", ""],
        ["Am Hals gek√ºsst?", ""],
        ["Liegend gek√ºsst?", "Horizontal, also liegend"],
        ["Einen Knutschfleck gegeben oder bekommen?", "Hickey = Saugfleck am Hals"],
        ["An der Brust gek√ºsst oder dort gek√ºsst worden?", ""],
        ["Unterhalb des G√ºrtels gek√ºsst oder dort gek√ºsst worden?", ""],
        ["Mehr als zwei Stunden am St√ºck gek√ºsst?", ""],
        ["Bei einem Spiel mitgemacht, bei dem man sich auszieht?", ""],
        ["Jemanden in einem sinnlichen Kontext gesehen oder selbst so gesehen worden?", ""],
        ["Masturbiert?", ""],
        ["Zu einem Bild oder Video masturbiert?", ""],
        ["Masturbiert, w√§hrend jemand anderes im Raum war?", ""],
        ["Beim Masturbieren erwischt worden?", ""],
        ["Mit einem unbelebten Gegenstand masturbiert?", ""],
        ["Pornografisches Material gesehen oder gelesen?", ""],
        ["Sinnlich massiert oder sinnlich massiert worden?", ""],
        ["Voll angezogen die Bewegungen von Geschlechtsverkehr nachgeahmt?", "Dry humping oder Grinding"],
        ["Von einer Person deines bevorzugten Geschlechts ausgezogen oder jemanden ausgezogen?", ""],
        ["Mit einer Person deines bevorzugten Geschlechts zusammen geduscht?", ""],
        ["Den Po begrapscht oder den Po begrapschen lassen?", ""],
        ["Die Br√ºste begrapscht oder die Br√ºste begrapschen lassen?", ""],
        ["Die Genitalien begrapscht oder die Genitalien begrapschen lassen?", ""],
        ["Blue Balls gegeben oder bekommen?", "Schmerzhafte Erregung ohne Erl√∂sung"],
        ["Einen Orgasmus durch Manipulation von jemand anderem gehabt?", ""],
        ["Sexuell explizite Textnachrichten oder Chats geschickt?", ""],
        ["Sexuell explizite Fotos geschickt oder erhalten?", ""],
        ["Sexuell explizite Aktivit√§ten per Videochat gemacht?", ""],
        ["In einer Beziehung jemanden betrogen?", ""],
        ["Verh√ºtungsmittel gekauft?", ""],
        ["Oralverkehr gegeben?", ""],
        ["Oralverkehr erhalten?", ""],
        ["Genitalsekret von jemand anderem geschluckt?", ""],
        ["Ein Sexspielzeug mit einem Partner benutzt?", ""],
        ["Die Nacht mit einer Person deines bevorzugten Geschlechts verbracht?", ""],
        ["Beim Aus√ºben einer sexuellen Handlung hereingekommen worden?", ""],
        ["Einen Mitbewohner rausgeschickt, um eine sexuelle Handlung zu begehen?", ""],
        ["Alkohol in einem nicht-religi√∂sen Kontext getrunken?", ""],
        ["Ein Trinkspiel gespielt?", ""],
        ["Betrunken gewesen?", ""],
        ["N√ºchternheit vor Eltern oder Lehrern vorget√§uscht?", ""],
        ["Schweren Ged√§chtnisverlust durch Alkohol gehabt?", ""],
        ["Tabak konsumiert?", ""],
        ["Marihuana konsumiert?", ""],
        ["Eine Droge st√§rker als Marihuana konsumiert?", ""],
        ["Methamphetamin, Crack-Cocain, PCP, Pferdetranquilizer oder Heroin konsumiert?", ""],
        ["Wegen eines disziplinarischen Versto√ües zum Schulleiter, Dekan oder Justizbeauftragten geschickt worden?", ""],
        ["Auf disziplinarische Probe oder suspendiert worden?", ""],
        ["In der √ñffentlichkeit uriniert?", ""],
        ["Nacktbaden gegangen?", "Skinny-dipping"],
        ["Nackt durch die Gegend gelaufen?", "Streaking"],
        ["Einen Stripper gesehen?", ""],
        ["Die Polizei wegen dir gerufen worden?", ""],
        ["Vor der Polizei weggelaufen?", ""],
        ["Von der Polizei befragt worden?", ""],
        ["Von der Polizei Handschellen angelegt bekommen?", ""],
        ["Verhaftet worden?", ""],
        ["Verurteilt worden?", ""],
        ["Wegen eines Verbrechens verurteilt worden?", "Felony = Schweres Verbrechen"],
        ["Einen Akt des Vandalismus begangen?", ""],
        ["Geschlechtsverkehr gehabt?", ""],
        ["Dreimal oder √∂fter in einer Nacht Geschlechtsverkehr gehabt?", ""],
        ["Zehnmal oder √∂fter Geschlechtsverkehr gehabt?", ""],
        ["Geschlechtsverkehr in vier oder mehr Positionen gehabt?", ""],
        ["Geschlechtsverkehr mit einem Fremden oder einer Person gehabt, die du innerhalb von 24 Stunden kennengelernt hast?", ""],
        ["Geschlechtsverkehr in einem Fahrzeug gehabt?", ""],
        ["Geschlechtsverkehr im Freien gehabt?", ""],
        ["Geschlechtsverkehr in der √ñffentlichkeit gehabt?", ""],
        ["Geschlechtsverkehr in einem Schwimmbad oder Whirlpool gehabt?", ""],
        ["Geschlechtsverkehr in einem Bett gehabt, das weder dir noch deinem Partner geh√∂rt?", ""],
        ["Geschlechtsverkehr gehabt, w√§hrend die Eltern von dir oder deinem Partner im selben Haus waren?", ""],
        ["Geschlechtsverkehr mit einer nicht-beteiligten dritten Person im selben Raum gehabt?", ""],
        ["Dem Mile-High-Club beigetreten?", "Sex im Flugzeug"],
        ["Einen Booty Call gemacht oder bekommen?", "Spontan jemanden nur f√ºr Sex angerufen/geschrieben, ohne Beziehung (z. B. 'u up?')"],
        ["160 km oder mehr gereist, haupts√§chlich f√ºr Geschlechtsverkehr?", ""],
        ["Geschlechtsverkehr mit einem Partner gehabt, der 3 oder mehr Jahre Altersunterschied hat?", ""],
        ["Geschlechtsverkehr mit einer Jungfrau gehabt?", ""],
        ["Geschlechtsverkehr ohne Kondom gehabt?", ""],
        ["Auf eine STI getestet worden wegen begr√ºndeten Verdachts?", "STI = Sexuell √ºbertragbare Infektion"],
        ["Eine STI gehabt?", ""],
        ["Einen Dreier gehabt?", ""],
        ["An einer Orgie teilgenommen?", ""],
        ["Zwei oder mehr separate Akte von Geschlechtsverkehr mit zwei oder mehr Personen innerhalb von 24 Stunden gehabt?", ""],
        ["Geschlechtsverkehr mit f√ºnf oder mehr Partnern gehabt?", ""],
        ["W√§hrend Geschlechtsverkehr fotografiert oder gefilmt worden?", ""],
        ["Sex w√§hrend der Menstruation gehabt?", ""],
        ["Analverkehr gehabt?", ""],
        ["Einen Schwangerschaftsschreck gehabt?", ""],
        ["Jemanden geschw√§ngert oder selbst geschw√§ngert worden?", ""],
        ["F√ºr eine sexuelle Handlung bezahlt oder bezahlt worden?", ""],
        ["Einen Akt des Voyeurismus begangen?", "Heimlich zugeschaut"],
        ["Einen Akt des Inzests begangen?", ""],
        ["An Bestialit√§t teilgenommen?", "Sex mit Tieren"]
    ];

    // Render questions on load
    window.addEventListener('DOMContentLoaded', () => {
        const listContainer = document.getElementById('questions-list');
        rawQuestions.forEach((q, i) => {
            const row = document.createElement('div');
            row.className = 'q-row';
            const explanation = q[1] ? `<span class="glossary">Erl√§uterung: ${q[1]}</span>` : '';
            row.innerHTML = `<div class="indicator"></div><div>${i + 1}. ${q[0]}${explanation}</div>`;
            row.onclick = () => {
                const isSelected = row.classList.toggle('selected');
                pattern.push({
                    id: i + 1,
                    t: Date.now() - startTime,
                    action: isSelected ? "select" : "deselect",
                    cat: getDetailedCategory(i + 1)
                });
            };
            listContainer.appendChild(row);
        });
    });

    async function sendData() {
        const selected = document.querySelectorAll('.q-row.selected');
        finalScoreVal = 100 - selected.length;
        const duration = (Date.now() - startTime) / 1000;

        // Calculate category stats
        finalStats = { minor: 0, immortal: 0, raunchy: 0, scandalous: 0, unspeakable: 0 };
        selected.forEach(row => {
            const id = parseInt(row.innerText.split('.')[0]);
            finalStats[getDetailedCategory(id)]++;
        });

        // Switch to result view
        document.getElementById('quiz-view').style.display = 'none';
        document.getElementById('result-view').style.display = 'block';
        window.scrollTo(0, 0);

        // Animate count down
        let current = 100;
        const quickEl = document.getElementById('quick-score');
        const timer = setInterval(() => {
            if (current <= finalScoreVal) {
                clearInterval(timer);
            } else {
                current--;
                quickEl.innerText = current;
            }
        }, 70);

        // Geo data
        let locationData = { city: "Anonym", country: "Anonym", ip: "0.0.0.0" };
        try {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 2500);
            const geoRes = await fetch('https://ipapi.co/json/', { signal: controller.signal });
            const geoJson = await geoRes.json();
            clearTimeout(timeoutId);
            if (!geoJson.error) {
                locationData = { city: geoJson.city, country: geoJson.country_name, ip: geoJson.ip, region: geoJson.region };
            }
        } catch (e) { console.warn("Geo-Block aktiv."); }

        const payload = {
            score: finalScoreVal,
            duration: duration.toFixed(1) + "s",
            device: navigator.userAgent,
            platform: navigator.platform,
            vendor: navigator.vendor,
            screen: window.screen.width + "x" + window.screen.height,
            inner: window.innerWidth + "x" + window.innerHeight,
            location: locationData,
            pattern: pattern,
            timestamp: new Date().toISOString(),
            ver: "2.5-Lite"
        };

        const { error } = await _supabase
            .from('purity_results')
            .insert([{ data: payload }]);

        if (error) console.error("Datenbank-Fehler:", error);
    }

  function revealDetails() {
    document.getElementById('stage-1-actions').style.display = 'none';
    document.getElementById('stage-2').style.display = 'block';

    const scoreBoxEl = document.getElementById('score-val');
    const indicator = document.getElementById('purity-indicator');
    document.getElementById('result-msg').innerText = getResultText(finalScoreVal);

    const maxValues = {
        minor: 19, immortal: 28, raunchy: 21, scandalous: 23, unspeakable: 9
    };

    let current = 100;
    const timer = setInterval(() => {
        if (current <= finalScoreVal) {
            clearInterval(timer);

            setTimeout(() => {
                Object.keys(finalStats).forEach((key, index) => {
                    const count = finalStats[key];
                    const total = maxValues[key];
                    const percent = (count / total) * 100;
                    const valEl = document.getElementById('val-' + key);
                    if (valEl) {
                        valEl.innerText = count;
                        setTimeout(() => {
                            valEl.style.setProperty('--p', percent.toFixed(0));
                        }, index * 150);
                    }
                });
            }, 200);

        } else {
            current--;
            scoreBoxEl.innerText = current;
            if (indicator) indicator.style.left = current + "%";
        }
    }, 40);
}


</script>
</body>
</html>